<div [formGroup]="form!" class="time-picker-wrapper">
  <!-- Regular input mode -->
  @if (!inline()) {
    <div [class.disabled]="disabled()" [class.focus]="isOpen()" class="input-wrapper">
      <input #timePickerInput (focus)="onFocusInput()" [attr.disabled]="disabled()? 'disabled':null"
        [class.disabled]="disabled()" [class.focus]="isOpen()" [disableInputMask]="disableInputMask()"
        [dtp-dateMask]="displayFormat()" [placeholder]="effectivePlaceholder()"
        [readonly]="readOnly() || readOnlyInput()" class="time-picker-input" formControlName="timeInput" type="text">
      @if (showIcon()) {
        <button (click)="toggleTimePicker($event)" class="time-button" tabindex="-1">
          <svg fill="none" height="20" stroke="#999" stroke-width="2" viewBox="0 0 24 24" width="20"
            xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" />
            <path d="M12 6v6l4 2" />
          </svg>
        </button>
      }
    </div>
    <ng-template (detach)="close()" (positionChange)="onPositionChange($event)" [cdkConnectedOverlayHasBackdrop]="false"
      [cdkConnectedOverlayOpen]="isOpen()" [cdkConnectedOverlayOrigin]="origin!"
      [cdkConnectedOverlayPositions]="overlayPositions" [cdkConnectedOverlayTransformOriginOn]="'.time-picker-popup'"
      cdkConnectedOverlay nzConnectedOverlay>
      <ng-container *ngTemplateOutlet="timePickerContent"></ng-container>
    </ng-template>
  } @else {
    <!-- Inline mode -->
    <ng-container *ngTemplateOutlet="timePickerContent"></ng-container>
  }



  <!-- Time Picker Content Template -->
  <ng-template #timePickerContent>
    <div #popupWrapper (click)="$event.stopPropagation()" [@slideMotion]="'enter'" [class.disabled]="disabled()"
      [class.inline]="inline()" [class]="'time-picker-popup ' + cssClass()" style="position: relative">
      <div class="time-picker-content">
        <div class="time-columns">
          <!-- Hours -->
          <div class="time-column">
            <div class="time-scroller">
              @for (hour of hours(); track hour) {
                <button (click)="selectHour(hour)" [class.disabled]="isHourDisabled(hour)"
                  [class.selected]="selectedTime().hour === hour" [id]="'selector_h'+hour" type="button">
                  {{ hour.toString().padStart(2, '0') }}
                </button>
              }
            </div>
          </div>

          <div class="time-separator">:</div>

          <!-- Minutes -->
          <div class="time-column">
            <div class="time-scroller">
              @for (minute of minutes; track minute) {
                <button (click)="selectMinute(minute)"
                  [class.disabled]="isMinuteDisabled(minute)" [class.selected]="selectedTime().minute === minute"
                  [id]="'selector_m'+minute" type="button">
                  {{ minute.toString().padStart(2, '0') }}
                </button>
              }
            </div>
          </div>

          <!-- Seconds (if format includes seconds) -->
          @if (showSeconds()) {
            <div class="time-separator">:</div>
            <div class="time-column">
              <div class="time-scroller">
                @for (second of seconds; track second) {
                  <button (click)="selectSecond(second)"
                    [class.disabled]="isSecondDisabled(second)" [class.selected]="selectedTime().second === second"
                    [id]="'selector_s'+second" type="button">
                    {{ second.toString().padStart(2, '0') }}
                  </button>
                }
              </div>
            </div>
          }

          <!-- AM/PM (only in 12-hour format) -->
          @if (timeFormat() === '12') {
            <div class="time-column period">
              @for (period of periods(); track period) {
                {{periods().length}}
                <button (click)="selectPeriod(period)"
                  [class.selected]="selectedTime().period === period" type="button">
                  {{ period }}
                </button>
              }
            </div>
          }
        </div>
      </div>

      @if (!inline()) {
        <div class="time-picker-footer">
          <div class="footer-buttons">
            <button (click)="selectNow()" class="now-btn" type="button">{{ effectiveLang().now }}</button>
          </div>
          <div class="footer-actions">
            <button (click)="save()" class="save-btn" type="button">{{ effectiveLang().ok }}</button>
          </div>
        </div>
      }
    </div>
  </ng-template>
</div>
